---
import PostCard from "~/components/PostCard.astro";
import Layout from "~/layouts/Layout.astro";

const postEntries = await Astro.glob("../../database/post/*.md");

const posts = await Promise.all(
  postEntries.map(async post => {
    const compiled = await post.compiledContent();
    const compiledString = typeof compiled === "string" ? compiled : String(compiled ?? "");
    const preview = compiledString
      .replace(/<[^>]*>/g, " ")
      .replace(/\s+/g, " ")
      .trim()
      .slice(0, 180);

    return {
      slug: post.frontmatter.slug,
      title: post.frontmatter.title,
      createdTime: post.frontmatter.생성일,
      tags: Array.isArray(post.frontmatter.태그) ? post.frontmatter.태그 : [],
      preview,
    };
  })
);
---

<Layout title="Topic @TriFullKim" id="post">
  <main>
    <div class="post-space">
      {
        posts.map(post => (
          <PostCard
            slug={post.slug}
            title={post.title}
            createdTime={post.createdTime}
            tags={post.tags}
          >
            {post.preview}
          </PostCard>
        ))
      }
    </div>
  </main>
</Layout>
<style>
  .post-space {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
    padding: 10px;
  }
  
  @media (min-width: 768px) {
    .post-space {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
